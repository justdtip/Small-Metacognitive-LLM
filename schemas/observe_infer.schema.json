{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/observe_infer.schema.json",
  "title": "ObserveInferRecord",
  "type": "object",
  "additionalProperties": true,
  "properties": {
    "request_id": {"type": "string"},
    "ts_ms": {"type": "integer"},
    "model": {"type": "string"},
    "device": {"type": "string"},
    "decode": {
      "type": "object",
      "properties": {
        "temperature": {"type": "number"},
        "top_p": {"type": "number"},
        "max_new_tokens": {"type": "integer"}
      },
      "required": ["temperature", "top_p", "max_new_tokens"]
    },
    "timing": {
      "type": "object",
      "properties": {
        "latency_s": {"type": "number"},
        "tokens_per_sec": {"type": "number"}
      },
      "required": ["latency_s"]
    },
    "io": {
      "type": "object",
      "properties": {
        "input_tokens": {"type": "integer"},
        "output_tokens": {"type": "integer"},
        "visible_cot": {"type": "boolean"}
      },
      "required": ["input_tokens", "output_tokens", "visible_cot"]
    },
    "sections": {
      "type": "object",
      "properties": {
        "think_tokens": {"type": "integer"},
        "answer_tokens": {"type": "integer"}
      }
    },
    "heads": {"type": ["object", "null"]},
    "activations": {
      "type": "object",
      "properties": {
        "layer_last_token_norms": {"type": "array", "items": {"type": "number"}},
        "attn_entropies_last_token": {"type": ["array", "null"], "items": {"type": "number"}}
      }
    },
    "gates": {
      "type": "object",
      "properties": {
        "num_gated_modules": {"type": ["integer", "null"]},
        "mean_gate_activity": {"type": ["number", "null"]}
      }
    },
    "logprobs": {"type": ["array", "null"], "items": {"type": ["number", "null"]}},
    "text": {
      "type": "object",
      "properties": {
        "full": {"type": ["string", "null"]},
        "answer": {"type": "string"}
      },
      "required": ["answer"]
    }
  },
  "required": ["request_id", "ts_ms", "model", "device", "decode", "timing", "io", "sections", "text"]
}

